import CreateHTMLElement from"../CreateHTMLElement.js";import VisitCardiologist from"../cards/VisitCardiologist.js";import VisitDentist from"../cards/VisitDentist.js";import VisitTherapist from"../cards/VisitTherapist.js";import Fetch from"../../api/Fetch.js";import Valid from"../../functionForValid/Valid.js";import Lisener from"../../Lisener/Lisener.js";import{addLocalStorageData}from"../../function/localStorage.js";export default class Form extends CreateHTMLElement{constructor({className:e,id:t,formData:{inputsAndSelect:a,labels:r,btnSubmit:i},ariaLabelledby:s,ariaHidden:o,tabindex:n="",role:l="",text:d}){super(e,t),this.inputsAndSelect=a,this.btnSubmit=i,this.labels=r,this.tabindex=n,this.role=l,this.ariaLabel=s,this.ariaHidden=o,this.text=d}render(e,t){this.createForm(),this.addElement(e,t),this.addFields(),this.listenerSubmit()}createForm(){this.createElement({name:"form",attributes:{innerHTML:this.text,name:"registration-form",tabindex:this.tabindex,role:this.role,"aria-labelledby":this.ariaLabel,"aria-hidden":this.ariaHidden}})}addFields(){this.labels.forEach((e=>e.render(`.${this.className[0]} .modal-body`,"beforeend"))),this.btnSubmit.forEach((e=>{"main__form-btn-close"===e.className[0]?e.render(`.${this.className[0]} .modal-header`,"beforeend",`.${this.className[0]}`):e.render(`.${this.className[0]} .modal-footer`,"beforeend")})),this.inputsAndSelect.forEach(((e,t)=>e.render(`.${this.labels[t].className[1]}`,"beforeend")))}isValidValue(e,t){t.forEach((t=>{new Valid(e.target.elements[t].value,e.target.elements[t]).render(t)}))}getValue(e,t){const a={};let r=null,i=null;return t.forEach((t=>{const s=e.target.elements[t].value;"patientMass"===t?r=s:"patientGrowth"===t?i=s:t.includes("Name")?a.fullName=a.fullName?a.fullName+s+" ":s+" ":a[t]=s,r&&i&&(a.bodyMassIndex=(r/(.01*i)**2).toFixed(2))})),a}static renderModalCard(e){const{id:t,...a}=e,r={id:`card-${t}`,className:["card","m-1"],style:"width: 70rem",...a};let i=null;"Кардиолог"===e.doctor?i=new VisitCardiologist(r):"Терапевт"===e.doctor?i=new VisitTherapist(r):"Стоматолог"===e.doctor&&(i=new VisitDentist(r)),i.render(".cards-wrapper","beforeend")}postAndCreateData(e,t){Fetch.createData(this.getValue(e,t)).then((e=>e.json())).then((e=>{Form.renderModalCard(e),addLocalStorageData(e)})).then((()=>{const e=document.getElementById("exampleModalCenter");document.body.className="",e.classList.remove("show"),e.style.cssText="",document.querySelector(".modal-backdrop").remove();document.querySelector(".main__form").remove(),document.querySelector(".text-danger").remove()}))}getAndValidDataWithForm(e,t){t.preventDefault();const a=[...e.elements].filter((e=>e.name)).map((e=>e.name));this.isValidValue(t,a),e.querySelector(".main__not-valid-input")||this.postAndCreateData(t,a)}listenerSubmit(){"main__form"===this.className[0]&&Lisener.render(`.${this.className[0]}`,"submit",this.getAndValidDataWithForm.bind(this))}}